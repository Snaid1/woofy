<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Tutorial on creating comic definitions for Woofy</title>
<meta name="keywords" content="tutorial woofy definition comicinfo webcomic comix download comic strip woofy" />
<meta name="description" content="" />
<link href="default.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="favicon.ico"  />
</head>
<body>
<div id="header">
	<h1>Woofy</h1>
	<h2>the webcomic downloader</h2>
</div>
<!-- end #header -->
<div id="menu">
	<ul>
		<li class="first"><a href="index.html" accesskey="1" title="">Home</a></li>
		<li><a href="screenshots.html" accesskey="2" title="">Screenshots</a></li>
		<li><a href="downloads.html" accesskey="3" title="">Downloads</a></li>
		<li><a href="http://woofy.sourceforge.net/flyspray" accesskey="5" title="">Bug tracker</a></li>
	</ul>
</div>
<!-- end #menu -->
<div id="content">
	<div id="posts">
		<div class="post">
			<div class="story">
<h2>Woofy's download algorithm</h2>

<p>Woofy's download algorithm is pretty much straight-forward: it visits a comic's web pages one by one, from the current strip to the first one, and it downloads the strips from each page.</p>

<p>When visiting a page, it searches it in order to find a link to the comic strip, and a link to the next page. If either of those isn't found then it assumes that it has reached the first strip, so it stops and reports that the download has finished.</p>
<p>Don't forget that you can use the <a href="images/scr_defdebugger.jpg">definition debugger</a> to better understand the way Woofy uses your custom definitions. It provides more information than when downloading a comic, plus it's way faster as it only checks the comic links and doesn't download them.</p>
<hr />
<h2>The structure of a comic definition</h2>

<p>A comic definition consists of a single xml file, describing how Woofy should visit and download the comic, and it looks kinda like the following fragment:</p>

<blockquote>
<p>&lt;comicInfo friendlyName="My Fabulous Comic. Seriously." allowMultipleStrips="false" allowMissingStrips="false" author="Pogonitch" authorEmail="pogo@helloworld.com" &gt;<br />
  &nbsp;&nbsp;&nbsp;&nbsp;&lt;startUrl&gt;&lt;![CDATA[...]]&gt;&lt;/startUrl&gt;<br />
  &nbsp;&nbsp;&nbsp;&nbsp;&lt;firstIssue&gt;&lt;![CDATA[...]]&gt;&lt;/firstIssue&gt;<br />
  &nbsp;&nbsp;&nbsp;&nbsp;&lt;rootUrl&gt;&lt;![CDATA[...]]&gt;&lt;/rootUrl&gt;<br />
  &nbsp;&nbsp;&nbsp;&nbsp;&lt;comicRegex&gt;&lt;![CDATA[...]]&gt;&lt;/comicRegex&gt;<br />
  &nbsp;&nbsp;&nbsp;&nbsp;&lt;backButtonRegex&gt;&lt;![CDATA[...]]&gt;&lt;/backButtonRegex&gt;<br />
  &nbsp;&nbsp;&nbsp;&nbsp;&lt;latestPageRegex&gt;&lt;![CDATA[...]]&gt;&lt;/latestPageRegex&gt;<br />
  &lt;/comicInfo&gt;</p>
</blockquote>

<p>Note that each xml element wraps its content in a <a target="_blank" href="http://en.wikipedia.org/wiki/Cdata">CDATA</a> region. This is because the content might contain angle brackets, and those would break the xml markup.</p>

<p>First, let's take a look at the attributes, in order to better understand how to use them:</p>
<ul>
    <li><strong>friendlyName</strong> - the comic's name, the one that Woofy will display in the comics list;</li>
    <li><strong>allowMultipleStrips</strong> - false by default; use this in order to tell Woofy that it shouldn't stop downloading if several strips are found in the same page;</li>
    <li><strong>allowMissingStrips</strong> - false by default;  use this in order to tell Woofy that it shouldn't stop downloading if a page contains no strips;</li>
    <li><strong>author</strong> - the definition's author; it will appear in the About dialog;</li>
    <li><strong>authorEmail</strong> - the definition author's email :)</li>
</ul>

<p>Now, let's see what each of the elements do:</p>

<ul><li>
<strong>startUrl</strong> - the url at which to start looking for strips; it will usually be the comic's start page;
</li><li>
<strong>firstIssue</strong> - this is the url to the comic's very first issue; Woofy will not consider this element, but it's being used in the automated tests, in order to determine whether Woofy can visit all the pages for that comic or it gets stuck somewhere; setting it is recommended.
</li>
<li><strong>rootUrl</strong> - the url with which to combine the relative comic/button paths; should be specified if the startUrl can't be used for this (see the "Looking for Group" definition for an example).</li>
<li>
<strong>comicRegex</strong> - this is where it gets interesting; in order to be able to retrieve a strip's link from a page, Woofy needs to know how the link looks like, so we describe it, using .NET <a target="_blank" href="http://en.wikipedia.org/wiki/Regular_expressions">regular expressions</a>;
</li><li>
<strong>backButtonRegex</strong> - a regular expression describing how the link to the previous page looks like.
</li>
<li><strong>latestPageRegex</strong> - a regular expression describing the link to the comic's latest page; this should be used when the comic doesn't have a fixed page displaying the latest strip, but instead offers a link to the latest strip in the startUrl.</li>
</ul>

<p>Note that the <b>comicRegex</b>, <b>backButtonRegex</b> and <strong>latestPageRegex</strong> elements allow the use of the <strong>content</strong> grouping construct, in order to wrap the actual link contained in a wider expression (see the "Least I Could Do" definition for an example).</p>

<hr />
<h2>Building a comic definition from scratch</h2>

<p>Ok, now that we know how Woofy behaves and how a comic definition should look like, let's build our own, shall we? Let's build a definition for <a target="_blank" href="http://www.uglyhill.com/">Ugly Hill</a>.</p>

<p>For this, let's start with an empty template, like the one below:</p>

<blockquote>
<p>&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br />
&lt;comicInfo friendlyName=""&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;startUrl&gt;&lt;![CDATA[]]&gt;&lt;/startUrl&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;firstIssue&gt;&lt;![CDATA[]]&gt;&lt;/firstIssue&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;comicRegex&gt;&lt;![CDATA[]]&gt;&lt;/comicRegex&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;backButtonRegex&gt;&lt;![CDATA[]]&gt;&lt;/backButtonRegex&gt;<br />
&lt;/comicInfo&gt;</p>
</blockquote>

<p>Since the comic's name is "Ugly Hill", we should let Woofy know about that.</p>

<blockquote>
<p>&lt;comicInfo friendlyName="Ugly Hill"&gt;</p>
</blockquote>

<p>We should also specify the address at which Woofy should start looking for strips. Note that this is not necessarily the comic's home page, but a web page containing the most recent comic strip AND a link to the previous strip (that links to the strip before it, and so on).</p>

<blockquote>
<p>&lt;startUrl&gt;&lt;![CDATA[http://www.uglyhill.com]]&gt;&lt;/startUrl&gt;</p>
</blockquote>

<p>Now, in order to make the developer's life easier, fill in the address of the first comic issue, so that submitted comics will considered for automated tests. In order to to this, you'll have to visit Ugly Hill's first strip, and get it's link (not the page's link, the strip's link).</p>

<blockquote>
<p>&lt;firstIssue&gt;&lt;![CDATA[http://www.uglyhill.com/comics/20050523.jpg]]&gt;&lt;/firstIssue&gt;</p>
</blockquote>

<p>And now, let's do the interesting part - the regular expressions. For this, we will need a regular expressions tester. I personally use <a target="_blank" href="http://www.ultrapico.com/Expresso.htm">Expresso</a>, so the tutorial will use its concepts, but you should be ok with any other regex tester. In case you need it, an introduction to regular expressions is available at <a target="_blank" href="http://www.codeproject.com/dotnet/regextutorial.asp">http://www.codeproject.com/dotnet/regextutorial.asp</a>.</p>

<p>Anyways, let's get the source of the start page (<a target="_blank" href="http://www.uglyhill.com">http://www.uglyhill.com</a>), and paste it in Expresso's <b>Sample Text</b> area. Right. </p>

<p>Once we have done this, we need to search it for the current strip link. I prefer looking at the image's properties and getting the filename from there - in our case it's <b>20070726_luggage.jpg</b>. If we search the source code for it, we find something like</p>

<blockquote>
<p>&lt;img border=0 src="/comics/20070726_luggage.jpg" &gt;</p>
</blockquote>

<p>, of which we are only interested in <b>/comics/20070726_luggage.jpg</b>. All we need to do now is convert what we found into a .NET regular expression. Easy!</p>

<p>We do this by analyzing the desired fragment. Notice that it can be described as </p>

<blockquote>
<p>/comics/&lt;eight digits&gt;_&lt;some text, maybe even some digits&gt;.&lt;an image extension, may be jpg, may be something else&gt;</p>
</blockquote>

<p>A regular expression describing this could be</p>

<blockquote>
<p>/comics/[0-9]{8}_[^.]*\.(gif|jpg|jpeg|png)</p>
</blockquote>

<p>We test it in Expresso, and see that it actually matches the text we wanted. </p>

<p>Don't forget to test the regular expression you come up with on several of the comic's pages, to make sure it retrieves one and only one link. Otherwise, Woofy will assume it has finished downloading the comic, and it will stop.</p>

<p>Now, for the link to the previous page. We notice the back button is represented by the <b>back_button.gif</b> image, so we search the source code and find something like this:</p>

<blockquote>
<p>&lt;a href="/d/20070725.html" target="_self"&gt;&lt;img border=0 src="/images/back_button.gif"&gt;&lt;/a&gt;</p>
</blockquote>

<p>This time we need to find an expression for the whole fragment, in order to avoid retrieving the forward button instead of the back button. Long story short, the regular expression is as follows:</p>

<blockquote>
<p>&lt;backButtonRegex&gt;&lt;![CDATA[&lt;a\shref="/d/[0-9]{8}\.html"\starget="_self"&gt;&lt;img\sborder=0\ssrc="/images/back_button\.gif"&gt;&lt;/a&gt;]]&gt;&lt;/backButtonRegex&gt;</p>
</blockquote>

<p>Note that even though we're trying to match a larger text fragment, wich we're only interested in a tiny fragment inside, so we wrap it in a <b>content</b> capturing group. </p>

<p>The full comic definition should look like this:</p>

<blockquote>
<p>&lt;?xml version="1.0" encoding="utf-8" ?&gt;<br />
&lt;comicInfo friendlyName="Ugly Hill"&gt;<br />
 &nbsp;&nbsp;&nbsp;&nbsp;&lt;startUrl&gt;&lt;![CDATA[http://www.uglyhill.com]]&gt;&lt;/startUrl&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;firstIssue&gt;&lt;![CDATA[http://www.uglyhill.com/comics/20050523.jpg]]&gt;&lt;/firstIssue&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;comicRegex&gt;&lt;![CDATA[/comics/[0-9]{8}_[^.]*\.(gif|jpg|jpeg|png)]]&gt;&lt;/comicRegex&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;backButtonRegex&gt;&lt;![CDATA[&lt;a\shref="/d/[0-9]{8}\.html"\starget="_self"&gt;&lt;img\sborder=0\ssrc="/images/back_button\.gif"&gt;&lt;/a&gt;]]&gt;&lt;/backButtonRegex&gt;<br />
&lt;/comicInfo&gt;</p>
</blockquote>

<p>Now that the new comic definition is finished, you can try it out, by saving it as an xml file in the <b>ComicInfos</b> folder, inside Woofy's install folder. After doing this, start Woofy and try to download all the latest comics. If it reaches the first comic strip ever, then it's a success.</p>

<p>Enjoy.</p>


			
			</div>
		</div>
	</div>
	<!-- end #posts -->	
	<div style="clear: both;">&nbsp;</div>
</div>
<!-- end #content -->
<div id="footer">   
    <div id="left">
	    <p id="legal"><a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=195943&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo" /></a><br /></p>
	</div>
	<div id="right">
        <p>Logistix theme, designed by <a href="http://www.freecsstemplates.org/">Free CSS Templates</a></p>
    </div>
</div>
<!-- end #footer -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2162335-1";
urchinTracker();
</script>
</body>
</html>
